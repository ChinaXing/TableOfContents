/*
	TableOfContents Plugin for jQuery (by Doug Neiner)
	
	Based on code and concept by Janko Jovanovic 
	  in his article: http://www.jankoatwarpspeed.com/post/2009/08/20/Table-of-contents-using-jQuery.aspx
	
	This plugin is offered under the MIT license.
	(c) 2009 by Doug Neiner, http://dougneiner.com
*/
(function($){$.TableOfContents=function(f,g,h){var j=this;j.$el=$(f);j.el=f;j.toc="";j.listStyle=null;j.tags=["h1","h2","h3","h4","h5","h6"];j.init=function(){j.options=$.extend({},$.TableOfContents.defaultOptions,h);if(g==undefined||g==null)g="document.body";j.$scope=$(g);var a=j.$scope.find(j.tags.join(', ')).filter(':first');if(a.length!=1)return;j.starting_depth=j.options.startLevel;if(j.options.depth<1)j.options.depth=1;var b=j.tags.splice(j.options.startLevel-1,j.options.depth);j.$headings=j.$scope.find(b.join(', '));if(j.options.topLinks!==false){var c=$(document.body).attr('id');if(c==""){c=j.options.topBodyId;document.body.id=c};j.topLinkId=c};if(j.$el.is('ul')){j.listStyle='ul'}else if(j.$el.is('ol')){j.listStyle='ol'};j.buildTOC();if(j.options.proportionateSpacing===true&&!j.tieredList()){j.addSpacing()};return j};j.tieredList=function(){return(j.listStyle=='ul'||j.listStyle=='ol')};j.buildTOC=function(){j.current_depth=j.starting_depth;j.$headings.each(function(i,a){var b=this.nodeName.toLowerCase().substr(1,1);if(i>0||(i==0&&b!=j.current_depth)){j.changeDepth(b)};j.toc+=j.formatLink(this,b,i)+"\n";if(j.options.topLinks!==false)j.addTopLink(this)});j.changeDepth(j.starting_depth,true);if(j.tieredList())j.toc="<li>\n"+j.toc+"</li>\n";j.$el.html(j.toc)};j.addTopLink=function(a){var b=(j.options.topLinks===true?"Top":j.options.topLinks);var c=$("<a href='#"+j.topLinkId+"' class='"+j.options.topLinkClass+"'></a>").html(b);$(a).append(c)};j.formatLink=function(b,c,d){var e=b.id;if(e==""){e=j.buildSlug($(b).text());b.id=e};var a="<a href='#"+e+"'";if(!j.tieredList())a+=" class='"+j.depthClass(c)+"'";a+=">"+j.options.levelText.replace('%',$(b).text())+'</a>';return a};j.changeDepth=function(a,b){if(b!==true)b=false;if(!j.tieredList()){j.current_depth=a;return true};if(a>j.current_depth){var c=[];for(var i=j.current_depth;i<a;i++){c.push('<'+j.listStyle+'>'+"\n")};var d="<li>\n";j.toc+=c.join(d)+d}else if(a<j.current_depth){var e=[];for(var i=j.current_depth;i>a;i--){e.push('</'+j.listStyle+'>'+"\n")};j.toc+="</li>\n"+e.join('</li>'+"\n");if(!b){j.toc+="</li>\n<li>\n"}}else{if(!b){j.toc+="</li>\n<li>\n"}};j.current_depth=a};j.buildSlug=function(a){a=a.toLowerCase().replace(/[^a-z0-9 -]/gi,'').replace(/ /gi,'-');a=a.substr(0,50);return a};j.depthClass=function(a){return j.options.levelClass.replace('%',(a-(j.starting_depth-1)))};j.addSpacing=function(){var d=j.$headings.filter(':first').position().top;j.$headings.each(function(i,a){var b=j.$el.find('a:eq('+i+')');var c=(($(this).position().top-d)/(j.$scope.height()-d))*j.$el.height();b.css({position:"absolute",top:c})})};return j.init()};$.TableOfContents.defaultOptions={startLevel:1,depth:3,levelClass:"toc-depth-%",levelText:"%",topLinks:false,topLinkClass:"toc-top-link",topBodyId:"toc-top",proportionateSpacing:false};$.fn.tableOfContents=function(b,c){return this.each(function(){var a=new $.TableOfContents(this,b,c);delete a})}})(jQuery);